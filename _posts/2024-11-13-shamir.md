---
title: '[Crypto学习笔记] shamir共享密钥协议'
date: 2024-11-13
permalink: /posts/2024/11/arch_virtualbox_transfer/
excerpt: '以下是学习过程中的一系列常规rsa类题型汇总...'
tags:
  - CTF
  - 网络安全
  - rsa
---

# 目录

- [前置概念](#前置概念)
  - [拉格朗日插值法](#拉格朗日插值法)
  - [shamir原理](#shamir原理)
- [网鼎杯初赛](#网鼎杯初赛)
- [参考文献](#参考文献)

# 前置概念

## 拉格朗日插值法

对于**拉格朗日插值法**, 其实更广为人知(特别可能是公务员)的应该是以下题目:

> 试着找出?所代表的数:
>
> 1,3,5,7,?

大概学数学的看不惯这种没头没尾的逻辑题, 于是有人使用拉格朗日插值法做了个表情包<sup>[1]</sup>, 以下是实现逻辑:

1. 假设存在函数f(x)可以始得存在点(1,1), (2,3), (3,5), (4,7), (5, 114514)
2. 我们可以简单构造一个带有五个变量的多项式以满足函数f(x)的需求(这个原理很容易推导出, 我打算把它留给读者, 不过实际上已经有一个可视化视频已经很好地阐述了<sup>[2]</sup>.)
3. 可以使用拉格朗日插值法进行插值, 硬性凑出五个变量

某种意义上**拉格朗日插值法**原理与**泰勒级数**有一定的关联性, 我们先列出公式:

$$
\begin{matrix}
f(1) = 1      \\
f(2) = 3      \\
f(3) = 5      \\
f(4) = 7      \\
f(5) = 114514 \\
f(x) = 
a \times x^4 + 
b \times x^3 + 
c \times x^2 +
d \times x   +
e 
\end{matrix}
$$

当然我们还无法直接求出a,b,c,d,e, 还需要依靠**拉格朗日插值法**进行计算, 公式如下表达<sup>[1]</sup>:

$$
\begin{matrix}
f(x) = \sum f(x_i) \times f_i(x) \\
f_i(x) = \prod_{j \neq i} \frac{(x-x_j)}{(x_i-x_j)}
\end{matrix}
$$

将5个点带入函数, 有:

$$
f(x) = 
1 \times \frac{(x-2)(x-3)(x-4)(x-5)}{(1-2)(1-3)(1-4)(1-5)} +
3 \times \frac{(x-1)(x-3)(x-4)(x-5)}{(2-1)(2-3)(2-4)(2-5)} +
5 \times \frac{(x-1)(x-2)(x-4)(x-5)}{(3-1)(3-2)(3-4)(3-5)} +
7 \times \frac{(x-1)(x-2)(x-3)(x-5)}{(4-1)(4-2)(4-3)(4-5)} +
114514 \times \frac{(x-1)(x-2)(x-3)(x-4)}{(5-1)(5-2)(5-3)(5-4)}
$$

可以计算出结果如下:

$$
4771.041666666666*x^4 - 47710.41666666666*x^3 + 166986.4583333333*x^2 - 238550.0833333333*x + 114503.99999999999
$$

以上结果由sage得出, 我们同样可以使用sage进行验证:

```python
from sage.all import *

x = var('x')
f = 1*(x-2)*(x-3)*(x-4)*(x-5)*((1-2)*(1-3)*(1-4)*(1-5))**(-1) + \
    3*(x-1)*(x-3)*(x-4)*(x-5)*((2-1)*(2-3)*(2-4)*(2-5))**(-1) + \
    5*(x-1)*(x-2)*(x-4)*(x-5)*((3-1)*(3-2)*(3-4)*(3-5))**(-1) + \
    7*(x-1)*(x-2)*(x-3)*(x-5)*((4-1)*(4-2)*(4-3)*(4-5))**(-1) + \
    114514*(x-1)*(x-2)*(x-3)*(x-4)*((5-1)*(5-2)*(5-3)*(5-4))**(-1)

print(f.expand())
print(f(x=5))
# 4771.041666666666*x^4 - 47710.41666666666*x^3 + 166986.4583333333*x^2 - 238550.0833333333*x + 114503.99999999999
# 114513.99999999999
```

符合结论. 在**拉格朗日插值法**中, $f_i(x)$作为开启f(x)传入数值$x_i$的门, 当传入的x为对应数值, 明显有$f_i(x)=1$, 否则$f_i(x)=0$, 当然如果从函数上看我们可以有一个更为美妙的过程, 不过这里不是动画, 暂且省略不表. 

拉格朗日插值法可以以矩阵形式进行表述:

$$
\begin{bmatrix}
1 & x_1 & x_1^2 & ... & x_1^4 \\
1 & x_2 & x_2^2 & ... & x_2^4 \\
1 & x_3 & x_3^2 & ... & x_3^4 \\
1 & x_4 & x_4^2 & ... & x_4^4 \\
1 & x_5 & x_5^2 & ... & x_5^4
\end{bmatrix}
\times
\begin{bmatrix}
a \\
b \\
c \\
d \\
e
\end{bmatrix}
=
\begin{bmatrix}
1 \\
3 \\
5 \\
7 \\
114514
\end{bmatrix}
$$

数值参考以上题目, 对应有:

$$
x_i=i
$$

我们在采用拉格朗日插值法计算时可以通过矩阵与结果反求出向量:

$$
\begin{bmatrix}
a &
b &
c &
d &
e
\end{bmatrix}
^T
$$


## shamir原理

想象一下未来某一天要将自己的传家bitcoin交给子孙们, 但是担心传到某一代的时候有人突然决裂, 这时候其他人需要在少人的情况也能获取到bitcoin与其对抗, 但是决裂的人却无法获取bitcoin, shamir共享密钥协议解决了以上问题:

> 当一段密文需要多位成员保存, 且不确定保存的成员是否包含不可信任的人时, 能保证n位成员保存密钥, 通过n-x位成员也可以还原密文, 其中x < n.

现假设密文为m, 有公式如下<sup>[3]</sup>所示:

$$
\begin{bmatrix}
1 & x_1 & ... & x_1^{i-1} \\
1 & x_2 & ... & x_2^{i-1}\\
1 & x_3 & ... & x_3^{i-1}\\
... & ... & ... & ...\\
1 & x_j & ... & x_j^{i-1}
\end{bmatrix}
\times
\begin{bmatrix}
m \\
a_1 \\
a_2 \\
... \\
a_i
\end{bmatrix}
=
\begin{bmatrix}
y_0 \\
y_1 \\
y_2 \\
... \\
y_i
\end{bmatrix} 
(i<j)
$$

其中n位成员分别获取私钥为:

$$
x_1, x_2, ..., x_j
$$

如果能凑满所有成员的私钥, 我们可以按代数思维直接通过矩阵求逆获取m:

$$
{\begin{bmatrix}
1 & x_1 & ... & x_1^{i-1} \\
1 & x_2 & ... & x_2^{i-1}\\
1 & x_3 & ... & x_3^{i-1}\\
... & ... & ... & ...\\
1 & x_j & ... & x_j^{i-1}
\end{bmatrix}}^{-1}
\times
\begin{bmatrix}
y_0 \\
y_1 \\
y_2 \\
... \\
y_i
\end{bmatrix} 
=
\begin{bmatrix}
m \\
a_1 \\
a_2 \\
... \\
a_i
\end{bmatrix}
$$

如果参与获取信息的成员n有: i < n < j 时,


# 参考文献

- [1] olderciyuan.拉格朗日插值学习笔记[EB/OL]博客园.https://www.cnblogs.com/olderciyuan/p/15578688.html.2021-11-19.
- [2] 3blue1brown.【官方双语】微积分的本质-10-泰勒级数.https://www.bilibili.com/video/BV1Gx411Y7cz/.2017-06-11
- [3] 红烧喵.Shamir秘密共享协议[EB/OL]知乎.https://zhuanlan.zhihu.com/p/440667227.2021-12-03

